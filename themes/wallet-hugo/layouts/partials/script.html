<!-- AOS JS loaded asynchronously to prevent render blocking -->
<script>
  (function() {
    var script = document.createElement('script');
    script.src = 'https://unpkg.com/aos@next/dist/aos.js';
    script.async = true;
    script.onload = function () {
      if (typeof document !== 'undefined') {
        var eventName = 'aos:loaded';
        if (typeof window.CustomEvent === 'function') {
          document.dispatchEvent(new CustomEvent(eventName));
        } else if (typeof document.createEvent === 'function') {
          var event = document.createEvent('Event');
          event.initEvent(eventName, true, true);
          document.dispatchEvent(event);
        }
      }
    };
    document.head.appendChild(script);
  })();
</script>

<!-- font family -->
<script src="https://cdn.jsdelivr.net/gh/theprojectsomething/webfontloader@feature/google-fonts-v2/webfontloader.js"></script>
{{$pf:= site.Params.variables.primary_font | default `Rubik:wght@400;500;700`}}
{{$sf:= site.Params.variables.secondary_font}}
{{$fontFamilies := slice (printf "%s&display=swap" $pf) }}
{{ with $sf }}
  {{$fontFamilies = $fontFamilies | append (printf "%s&display=swap" (. | default `Rubik:wght@400;500;700`)) }}
{{ end }}
{{$fontFamiliesJSON := $fontFamilies | jsonify }}
<script type="application/javascript" data-font-families='{{ $fontFamiliesJSON | htmlEscape }}'>
  (function() {
    if (typeof window === 'undefined') return;
    if (sessionStorage.fontsLoaded === 'true') return;
    if (typeof WebFont === 'undefined') return;
    var scriptNode = document.currentScript;
    var fontFamilies = [];
    if (scriptNode && scriptNode.dataset.fontFamilies) {
      try {
        fontFamilies = JSON.parse(scriptNode.dataset.fontFamilies);
      } catch (error) {
        console.warn('Unable to parse font families', error);
      }
    }
    WebFont.load({
      google: {
        api: 'https://fonts.googleapis.com/css2',
        families: fontFamilies,
        version: 2
      },
      active: () => {
        sessionStorage.fontsLoaded = 'true';
      }
    });
  })();
</script>

<!-- JS Plugins + Main script -->
{{ $scripts := slice }}
{{ $scriptsLazy := slice }}
{{ range site.Params.plugins.js }}
  {{ if findRE "^http" .link }}
    <script
      defer
      src="{{ .link }}"
      type="application/javascript"
      {{ .attributes | safeHTMLAttr }}></script>
  {{ else }}
    {{ $scripts = $scripts | append (resources.Get .link) }}
  {{ end }}
{{ end }}

{{ $scripts = $scripts | append (resources.Get "js/script.js") }}
{{ $scripts = $scripts | resources.Concat "js/script.js" }}

{{ if hugo.IsProduction }}
  {{ $scripts = $scripts | minify | fingerprint }}
{{ end }}

{{/* scripts */}}
<script
  defer
  crossorigin="anonymous"
  integrity="{{ $scripts.Data.Integrity }}"
  src="{{ $scripts.RelPermalink }}"></script>

<!-- cookie -->
{{ with site.Params.cookies }}
{{ if .enable }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js"></script>
<div id="js-cookie-box" class="cookie-box cookie-box-hide">
	{{.content | markdownify}}<span id="js-cookie-button" class="btn btn-sm btn-outline-primary ml-2">{{.button}}</span>
</div>
<script type="application/javascript" data-expire-days="{{ .expire_days }}">
	(function ($) {
    const scriptNode = document.currentScript;
    const expireDays = scriptNode ? parseInt(scriptNode.dataset.expireDays || '0', 10) || 0 : 0;
		const cookieBox = document.getElementById('js-cookie-box');
		const cookieButton = document.getElementById('js-cookie-button');
		if (!Cookies.get('cookie-box')) {
			cookieBox.classList.remove('cookie-box-hide');
			cookieButton.onclick = function () {
				Cookies.set('cookie-box', true, {
					expires: expireDays
				});
				cookieBox.classList.add('cookie-box-hide');
			};
		}
	})(jQuery);
</script>

<!-- cookie style -->
<style>
.cookie-box {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  text-align: center;
  z-index: 9999;
  padding: 1rem 2rem;
  background: rgb(71, 71, 71);
  transition: all .75s cubic-bezier(.19, 1, .22, 1);
  color: #fdfdfd;
}

.cookie-box-hide {
  display: none;
}
</style>
{{ end }}
{{ end }}